<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Deew Shop</title>
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="manifest.json">
  <style>
    :root{--bg:#0f172a;--card:#1f2937;--accent:#16a34a;--muted:#9ca3af;}
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial,Helvetica,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#071029 0%, #081424 100%);color:#e6eef8}
    header{display:flex;align-items:center;gap:12px;padding:14px;background:#0b1220;position:sticky;top:0;z-index:10;justify-content:center}
    .brand{font-weight:800;font-size:20px}
    main{padding:12px;max-width:980px;margin:0 auto}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
    .card{background:var(--card);padding:12px;border-radius:14px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .menu-list{display:grid;gap:12px}
    .menu-item{background:#111827;border-radius:12px;overflow:hidden}
    .menu-item img{width:100%;height:auto;display:block}
    .mi-body{padding:10px}
    .price{font-weight:700}
    button.btn{background:var(--accent);border:none;padding:10px 12px;border-radius:10px;color:#032;cursor:pointer}
    .small{font-size:13px;color:var(--muted)}
    .cart-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.06)}
    .actions{display:flex;gap:8px}
    input,textarea,select{width:100%;padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.06);color:inherit}
    footer{padding:12px;text-align:center;color:var(--muted);font-size:13px}
    @media(max-width:880px){.grid{grid-template-columns:1fr}.card{margin-bottom:12px}}
  </style>
</head>
<body>
  <header>
    <div>
      <div class="brand">Deew Shop</div>
      <div class="small">Pastelaria ‚Äî Delivery</div>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <div style="display:flex;align-items:center;gap:10px;justify-content:space-between">
          <div>
            <h2 style="margin:6px 0 4px">Card√°pio</h2>
            <div class="small">Selecione seus past√©is</div>
          </div>
          <button class="btn" onclick="openSettings()">‚öôÔ∏è Configura√ß√µes</button>
        </div>
        <div style="margin-top:12px" id="menu" class="menu-list"></div>
      </section>

      <aside class="card">
        <h3>Seu Pedido</h3>
        <div id="cart" style="min-height:120px"></div>
        <div style="margin-top:10px">
          <div class="small">Pagamento</div>
          <select id="payMethod" onchange="toggleChangeField()">
            <option value="Pix">Pix</option>
            <option value="Dinheiro">Dinheiro</option>
          </select>
          <div id="changeField" style="display:none;margin-top:6px">
            <label class="small">Precisa de troco para quanto?</label>
            <input id="changeFor" placeholder="Ex: R$ 100,00" />
          </div>
          <div class="small" style="margin-top:10px">Cliente salvo:</div>
          <div id="client-summary" class="small"></div>
          <button class="btn" style="margin-top:8px;width:100%" onclick="ensureClient()">Fazer checkout</button>
        </div>
      </aside>
    </div>

    <section class="card" style="margin-top:12px">
      <h3>Cadastro / Endere√ßo</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:end">
        <div>
          <label class="small">Nome</label>
          <input id="name" placeholder="Seu nome" />
        </div>
        <div>
          <label class="small">Telefone</label>
          <input id="phone" placeholder="(DDD) 9xxxx-xxxx" />
        </div>
      </div>
      <div style="margin-top:8px">
        <label class="small">Endere√ßo</label>
        <textarea id="address" rows="2" placeholder="Rua, n√∫mero, bairro, refer√™ncia"></textarea>
      </div>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button class="btn" onclick="saveClient()">Salvar Cliente</button>
        <button onclick="clearClient()" style="padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.12);color:inherit">Limpar</button>
      </div>
    </section>

    <section id="settingsPanel" class="card" style="display:none; margin-top:12px">
      <h3>Configura√ß√µes</h3>
      <div class="small">Essas informa√ß√µes s√£o da Deew Shop.</div>
      <label class="small">N√∫mero do WhatsApp do estabelecimento</label>
      <input id="merchantPhone" value="5511988289671" />
      <label class="small" style="margin-top:8px">Chave Pix</label>
      <input id="pixKey" value="ad58bf60-dcbb-4670-979c-2ced8b857d28" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <input id="pixNote" placeholder="Ex: Pagar o total do pedido" />
        <button class="btn" onclick="copyPix()">Copiar chave</button>
      </div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn" onclick="saveSettings()">Salvar</button>
        <button onclick="closeSettings()" style="padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.12);color:inherit">Fechar</button>
      </div>
    </section>
  </main>

  <footer>
    ¬© Deew Shop ‚Äî PWA
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js').catch(console.warn);
        });
      }
    </script>
  </footer>

  <script>
  const MENU = [
    { id: 'p1', name: 'Pastel Prensado', price: 50, img: 'dr_planta_prensado.png' },
    { id: 'p2', name: 'Pastel de Flor', price: 35, img: 'dr_planta_flor.png' },
    { id: 'p3', name: 'Pastel de ICE', price: 90, img: 'homem_gelo_ice.png' },
    { id: 'p4', name: 'Pastel de Dry', price: 45, img: 'homem_barro_dry.png' }
  ];

  function toggleChangeField(){
    const m = document.getElementById('payMethod').value;
    document.getElementById('changeField').style.display = m==='Dinheiro' ? 'block' : 'none';
  }

  function loadClient(){
    const c = JSON.parse(localStorage.getItem('deew_client')||'null');
    if(c){document.getElementById('name').value=c.name||'';
      document.getElementById('phone').value=c.phone||'';
      document.getElementById('address').value=c.address||'';}
    refreshClientSummary();
  }
  function saveClient(){
    const c={name:document.getElementById('name').value.trim(),phone:document.getElementById('phone').value.trim(),address:document.getElementById('address').value.trim()};
    if(!c.name || !c.phone || !c.address){alert('Preencha nome, telefone e endere√ßo.');return}
    localStorage.setItem('deew_client',JSON.stringify(c));
    refreshClientSummary();
    alert('Cliente salvo!');
  }
  function clearClient(){localStorage.removeItem('deew_client');document.getElementById('name').value='';document.getElementById('phone').value='';document.getElementById('address').value='';refreshClientSummary();}
  function refreshClientSummary(){
    const c = JSON.parse(localStorage.getItem('deew_client')||'null');
    const el=document.getElementById('client-summary');
    el.innerText = c ? `${c.name} ‚Ä¢ ${c.phone} ‚Ä¢ ${c.address}` : 'Nenhum cliente salvo.';
  }

  function loadSettings(){
    const s=JSON.parse(localStorage.getItem('deew_settings')||'{}');
    document.getElementById('merchantPhone').value=s.merchantPhone||document.getElementById('merchantPhone').value;
    document.getElementById('pixKey').value=s.pixKey||document.getElementById('pixKey').value;
    document.getElementById('pixNote').value=s.pixNote||'';
  }
  function saveSettings(){
    const s={merchantPhone:document.getElementById('merchantPhone').value.trim(),pixKey:document.getElementById('pixKey').value.trim(),pixNote:document.getElementById('pixNote').value.trim()};
    localStorage.setItem('deew_settings',JSON.stringify(s));
    alert('Configura√ß√µes salvas.');
  }
  function openSettings(){document.getElementById('settingsPanel').style.display='block';}
  function closeSettings(){document.getElementById('settingsPanel').style.display='none';}
  function copyPix(){const k=document.getElementById('pixKey').value.trim(); if(!k){alert('Defina a chave Pix.');return} navigator.clipboard.writeText(k).then(()=>alert('Chave Pix copiada!'))}

  let CART = JSON.parse(localStorage.getItem('deew_cart')||'[]');
  function saveCart(){localStorage.setItem('deew_cart',JSON.stringify(CART));renderCart();}
  function addToCart(id){
    const item = MENU.find(m=>m.id===id); if(!item) return;
    const ex = CART.find(c=>c.id===id); if(ex) ex.qty++; else CART.push({id:item.id,name:item.name,price:item.price,qty:1});
    saveCart();
  }
  function removeFromCart(id){CART = CART.filter(c=>c.id!==id); saveCart();}
  function changeQty(id,delta){const it=CART.find(c=>c.id===id); if(!it) return; it.qty+=delta; if(it.qty<1) removeFromCart(id); saveCart();}
  function renderCart(){
    const el=document.getElementById('cart'); el.innerHTML='';
    if(CART.length===0){el.innerHTML='<div class="small">Carrinho vazio</div>'; return}
    let total=0;
    CART.forEach(ci=>{
      total += ci.price*ci.qty;
      const div=document.createElement('div');div.className='cart-item';
      div.innerHTML = `<div><div style="font-weight:700">${ci.name}</div><div class="small">R$ ${ci.price.toFixed(2)} x ${ci.qty}</div></div><div class="actions"><button onclick="changeQty('${ci.id}',-1)">-</button><button onclick="changeQty('${ci.id}',1)">+</button><button onclick="removeFromCart('${ci.id}')">‚úñ</button></div>`;
      el.appendChild(div);
    });
    const totalDiv=document.createElement('div');totalDiv.style.marginTop='8px';totalDiv.innerHTML=`<div style="display:flex;justify-content:space-between;font-weight:700">Total <span>R$ ${total.toFixed(2)}</span></div>`;
    el.appendChild(totalDiv);
  }

  function ensureClient(){
    const client = JSON.parse(localStorage.getItem('deew_client')||'null');
    if(!client){ alert('Salve seus dados antes do checkout.'); return; }
    if(CART.length===0){alert('Carrinho vazio!');return}
    const settings = JSON.parse(localStorage.getItem('deew_settings')||'{}');
    const hasNumber = (settings.merchantPhone||document.getElementById('merchantPhone').value).trim();
    if(!hasNumber){ openSettings(); return }
    openWhatsAppOrder();
  }
  function openWhatsAppOrder(){
    const client = JSON.parse(localStorage.getItem('deew_client'));
    const s = JSON.parse(localStorage.getItem('deew_settings')||'{}');
    const wa = (s.merchantPhone||document.getElementById('merchantPhone').value).replace(/[^0-9]/g,'');
    const pay = document.getElementById('payMethod').value;
    const changeFor = document.getElementById('changeFor').value.trim();
    let total=0; let lines=[];
    CART.forEach(ci=>{ total += ci.price*ci.qty; lines.push(`${ci.qty}x ${ci.name} ‚Äî R$ ${(ci.price*ci.qty).toFixed(2)}`); });
    const payLine = pay==='Dinheiro' ? `Dinheiro (troco para: ${changeFor||'n√£o informado'})` : `Pix (chave: ${s.pixKey||document.getElementById('pixKey').value})`;
    const body = `üì¶ *Pedido Deew Shop*\n\n*Cliente:* ${client.name} - ${client.phone}\n*Endere√ßo:* ${client.address}\n\n*Itens*:\n${lines.join('\n')}\n\n*Total:* R$ ${total.toFixed(2)}\n*Pagamento:* ${payLine}\n\nPor favor confirmar recebimento.`;
    const waUrl = `https://wa.me/${wa}?text=${encodeURIComponent(body)}`;
    window.open(waUrl,'_blank');
  }

  function renderMenu(){
    const m=document.getElementById('menu');
    MENU.forEach(item=>{
      const div=document.createElement('div');div.className='menu-item';
      div.innerHTML = `<img src="${item.img}" alt="${item.name}" /><div class="mi-body"><div style="display:flex;justify-content:space-between"><div><div style="font-weight:700">${item.name}</div><div class="small">Imagem ilustrativa</div></div><div class="price">R$ ${item.price.toFixed(2)}</div></div><div style="margin-top:8px;display:flex;gap:8px"><button class="btn" onclick="addToCart('${item.id}')">Adicionar</button></div></div>`;
      m.appendChild(div);
    });
  }

  renderMenu(); renderCart(); loadClient(); loadSettings(); toggleChangeField();
  </script>
</body>
</html>
